#!/bin/bash
# Linux Hello Configuration GUI Launcher
# Launched from /usr/bin/linux-hello-config

# Activer le daemon au premier lancement
systemctl --user enable hello-daemon.service 2>/dev/null || true
systemctl --user start hello-daemon.service 2>/dev/null || true

# Determine installation path
if [ -d "/usr/share/linux-hello/qml" ]; then
    # System installation from package
    APP_DIR="/usr/share/linux-hello"
else
    # Development installation
    SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
    APP_DIR="$SCRIPT_DIR/../linux_hello_config"
fi

# Set Qt environment variables
export QT_QPA_PLATFORM="xcb"
export QT_STYLE_OVERRIDE="org.kde.desktop"
export QML_XHR_ALLOW_FILE_READ="1"
# Set application metadata for window manager and taskbar
export QT_QPA_PLATFORMTHEME="kde"
export QT_APPLICATION_DISPLAY_NAME="Linux Hello"

# Launch QML application with proper window properties
exec qml -I "$APP_DIR/qml" \
    --apptype gui \
    -WindowTitle "Linux Hello - Configuration" \
    "$APP_DIR/qml/main.qml"
